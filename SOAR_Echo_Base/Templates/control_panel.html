<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Control Panel</title>
		<!-- Link to the Orbitron font from Google Fonts -->
		<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
		<link rel="stylesheet" href="{{url_for('static',filename='theme_stylesheet.css')}}" />
		<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
		<style>

			.background {
			    background: linear-gradient(to right, #003300, black);
			}
			/* .title{
			    color: white;
			} */
			.chart_holder {
				display: grid;
				grid-template-columns: auto;
				grid-template-rows: auto;
				column-gap: 1.5em;
				row-gap: 2em;
				width: fit-content;
				/* border: 1px solid red; */
			}
			.chart_formatter {
				width: fit-content;
				height: auto;
				border: 1px solid #CFC493;
			}
			.chart_title{
			    /* color: white; */
				margin: 0px;
			}
			#main_holder {
				display: flex;
				flex-direction: row;
				justify-content: space-between;
			}
			#left_column {
				/* Internal --------------------- */
				display: flex;
				flex-direction: column;
				/* justify-content: center; */
				flex-wrap: wrap;
				margin-left: 1em;
				/* border: 1px solid black; */
				background: white;

				/* External --------------------- */
				margin-right: 0.5em;
				height: fit-content;
				padding-left: 0.5em;
				padding-right: 0.5em;
				flex-grow: 2;
			}
			#right_column {
				/* Internal --------------------- */
				display: inline-block;
				overflow: scroll;
				/* max-height: 800px;
				max-width: 1000px; */
				/* max-height: var(--slider_height);
				max-width: var(--slider_width); */
				/* max-height: 500px;
				max-width: 700px; */
				border: 1px solid white;

				/* External --------------------- */
				margin-right: 3em;
				flex-grow: 0.1;
				width:fit-content;
				height:fit-content;
				background: white;


			}
		</style>
	</head>
	<body id="the_body">
		<header id="the_header">
			<h1 style="margin: 0px; flex-grow: 8;">SOAR Echo Base</h1>
			<div>
				<img src="{{ url_for('static', filename='settings_gear.svg') }}" class="header_svg_color_green" id="settings_gear" />
				<div
					style="z-index: 1; position: fixed; right:1%; top: 9%; background-color: white; padding: 5px;"
					id="settings_gear_div"
				>
					<!-- <p style="color: red; margin: 0px;">hi</p> -->

					<br />

					<!-- Theme and Color Buttons -->

					<!-- Theme Switcher Button -->
					<div style="display: flex; flex-direction: row;">
						<p style="margin: 0px; color: black; padding-right: 3px;" id="settings_menu_text">Theme:</p>
						<label class="ui-switch" style="display: block; width: fit-content;">
							<input type="checkbox" value="dark" id="theme_toggle" unchecked />
							<div class="slider">
								<div class="circle"></div>
							</div>
						</label>
					</div>
					<br />

					<!-- Optional Header Changing Buttons -->
					<div>
						<button id="header_theme_button_white">White</button>
						<br />
						<button id="header_theme_button_gold">Gold</button>
						<br />
						<button id="header_theme_button_black">Black</button>
						<br />
					</div>
				</div>
			</div>
		</header>
		<br />
		<br />
		<br />
		<a href="/gps_data"> GPS DATA SITE</a>
		<br />
		<br />

		<br />

		<br />
		<br />
		<div id="main_holder">
			<div id="left_column">
				<h2 style="margin-top: 0px;">Rocket Console</h2>
				<!-- <p>Hi</p> -->
				<div
					id="live_console"
					style="border: 1px solid black; height: 300px; overflow: scroll; white-space: pre-line; display: flex; flex-direction: column-reverse;"
				></div>
			</div>
			<div id="right_column">
				<h2>Payload Telemetry</h2>
				<!--<button id="start with GPS">Click to begin loading GPS data</button>-->

				<!-- Charts if necessary -->
				<div class="chart_holder">
					<div class="chart_formatter">
						<h3 class="chart_title">Altitude</h3>
						<div id="altitude_chart"></div>
						<!-- <br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br /> -->
					</div>

					<div class="chart_formatter">
						<h3 class="chart_title">Chart 2</h3>
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
						<br />
					</div>
				</div>
			</div>
		</div>

		<!-- Button Holder -->
		<div>
			<!-- Theme Switcher Button -->
			<label class="ui-switch" style="display: block; width: fit-content;">
				<input type="checkbox" value="dark" id="theme_toggle" unchecked />
				<div class="slider">
					<div class="circle"></div>
				</div>
			</label>

			<br />

			<!-- Optional Header Changing Buttons -->
			<div>
				<button id="green2white">Green to White</button>
				<button id="green2gold">Green to Gold</button>
				<button id="green2black">Green to Black</button>
			</div>

			<br />
		</div>

		<script type="module">
			import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
			//
			// import * as d3 from "{{url_for('static',filename='/control_panel_graph')}}"
			//Example from https://d3js.org/getting-started
			const width = 640;
			const height = 400;
			const marginTop = 20;
			const marginRight = 20;
			const marginBottom = 30;
			const marginLeft = 40;
			const x = d3.scaleUtc()
			    .domain([new Date("2023-01-01"), new Date("2024-01-01")])
			    .range([marginLeft, width - marginRight]);
			const y = d3.scaleLinear()
			    .domain([0, 100])
			    .range([height - marginBottom, marginTop]);
			const svg = d3.create("svg")
			    .attr("width", width)
			    .attr("height", height);
			svg.append("g")
			    .attr("transform", `translate(0,${height - marginBottom})`)
			    .call(d3.axisBottom(x));
			svg.append("g")
			    .attr("transform", `translate(${marginLeft},0)`)
			    .call(d3.axisLeft(y));
			document.getElementById("altitude_chart").append(svg.node());
		</script>

		<script>



			// Logging Console
			let logging_object = document.getElementById("live_console");
			let logger_reference_node = document.createTextNode("");
			logging_object.appendChild(logger_reference_node);
			function logger(information, error=false) {
				// Interestingly, the logger HTML element needed a CSS value of white-space: pre-line;
				// https://stackoverflow.com/questions/9980416/how-can-i-insert-new-line-carriage-returns-into-an-element-textcontent
				let new_text = document.createTextNode(information);

				let new_text_holder = document.createElement("div");
				new_text_holder.appendChild(new_text);
				new_text_holder.style.paddingTop = "10px";
				new_text_holder.style.paddingBottom = "10px";
				new_text_holder.style.paddingLeft = "5px";
				new_text_holder.style.borderTop = "0.5px solid black";
				if(error == true) {
					if (theme_value == "Light") {
						new_text_holder.style.backgroundColor = "rgb(253, 242, 245)";
						new_text_holder.style.color = "red";
					}
					if (theme_value == "Dark") {
						new_text_holder.style.backgroundColor = "rgb(75, 47, 54)";
						new_text_holder.style.color = "rgb(255, 179, 210)";
					}

				}

				logging_object.insertBefore(new_text_holder, logger_reference_node);
				logger_reference_node = new_text_holder;
			}





			//Color and Themes-------------------------------------------------------------------------------------------------------------
			//Code that will change the themes at the click of the Theme button
			let theme_button = document.getElementById("theme_toggle");
			theme_button.addEventListener("click", () => {
				// console.log(theme_button.checked);
				theme_changer(theme_button.checked);
			});

			function theme_changer(mode) {
				if (mode == true) {
					//Switching to dark mode
					console.log("Dark Mode now");
					document.getElementById("the_body").style = "background: linear-gradient(to right, #003300, black)";
					document.getElementById("left_column").style = "background: inherit; color: white";
					document.getElementById("settings_gear").setAttribute("class", "header_svg_color_white");

					banner_changer("dark");
				};
				if (mode == false) {
					//Switching to light mode
					console.log("Light Mode now");
					document.getElementById("the_body").style = "background: #CAD2D8";
					document.getElementById("left_column").style = "background: white; color: black";
					document.getElementById("settings_gear").setAttribute("class", "header_svg_color_black");

					banner_changer("greenwhite");
				};

			};

			/*Code that will change the color of the header at will, either as response due to
			clicking on the header changing buttons, or the Theme button*/
			document.getElementById("header_theme_button_white").addEventListener("click", () => {
				banner_changer("greenwhite");
			})
			document.getElementById("header_theme_button_gold").addEventListener("click", () => {
				banner_changer("greengold");
			})
			document.getElementById("header_theme_button_black").addEventListener("click", () => {
				banner_changer("dark");
			})
			function banner_changer(banner_value) {
				header = document.getElementById("the_header");
				if (banner_value == "dark") {
					header.style = "background: linear-gradient(to right, #003300, black)";
					document.getElementById("settings_gear").setAttribute("class", "header_svg_color_white");
					document.getElementById("settings_menu_text").style.color = "white";
					document.getElementById("settings_gear_div").style.backgroundColor = "black";
				};
				if (banner_value == "greengold") {
					header.style = "background: linear-gradient(135deg, rgba(0,103,71,1) 0%, rgba(207,196,147,1) 81%)";
					document.getElementById("settings_gear").setAttribute("class", "header_svg_color_green");
					document.getElementById("settings_menu_text").style.color = "rgba(207,196,147,1)";
					document.getElementById("settings_gear_div").style.backgroundColor = "black";
				};
				if (banner_value == "greenwhite") {
					header.style = "background: linear-gradient(135deg, rgba(0,103,71,1) 0%, rgba(255,255,255,1) 81%)"
					document.getElementById("settings_gear").setAttribute("class", "header_svg_color_green");
					document.getElementById("settings_menu_text").style.color = "black";
					document.getElementById("settings_gear_div").style.backgroundColor = "white";
				}
			};

			/*Code that will display the theme and color settings cards upon clicking on the settings gear*/
			let settings_gear = document.getElementById("settings_gear");
			let settings_gear_div = document.getElementById("settings_gear_div");
			let isactive_settings_popup = false;
			settings_gear.addEventListener("click", () => {
				if(isactive_settings_popup) {
					settings_gear_div.style.display = "none";
					isactive_settings_popup = false;
				}
				else{
					if(!isactive_settings_popup) {
					settings_gear_div.style.display = "block";
					isactive_settings_popup = true;
				}}
			});








			//BACK END CODE BEGINS --------------------------------------------------------------------------------------------------------

			//Script to connect with the server
			var server = 'http://' + document.domain + ':' + location.port;


			//My template for a promise to the promised land
			// 	function get_response() {
					//     const fetch_promise=fetch(server+'/button_test');
					//     fetch_promise
					//     .then((response)=>{
					//         if(!response.ok){
					//             throw new Error('HTTP error: ${response.status}');
					//         }
					//         return response.text();
					//     })
					//     .then((text)=>{
					//         console.log(text);
					//     })
					// }
		</script>
	</body>
</html>
